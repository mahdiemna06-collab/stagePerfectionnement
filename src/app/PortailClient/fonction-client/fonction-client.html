<section class="portail-client">

  <div class="profile-bar" *ngIf="currentUser">
    <div class="profile-info">
      <h3>{{ currentUser.prenom }} {{ currentUser.nom }}</h3>
      <ul>
        <li><strong>Email:</strong> {{ currentUser.email }}</li>
        <li><strong>Téléphone:</strong> {{ currentUser.telephone }}</li>
        <li><strong>Gouvernorat:</strong> {{ currentUser.gouvernorat }}</li>
      </ul>
    </div>

    <div class="profile-actions">
     <button (click)="demande()">déposer votre demande de crédit</button>

      <button (click)="logout()">Déconnexion</button>
    </div>
  </div>

  <!-- Formulaire -->
  <div class="container">
    <h2>Prendre un rendez-vous</h2>

    <form (ngSubmit)="createAppointment()" class="appointment-form">
      <input type="date" [(ngModel)]="appointmentDate" name="date" required>
      <input type="time" [(ngModel)]="appointmentTime" name="time" required>
      <textarea [(ngModel)]="appointmentReason" name="reason" placeholder="Motif" required></textarea>
      <button type="submit">Confirmer</button>
    </form>

    <!-- Liste -->
    <div class="appointments-section">
      <h3>Mes rendez-vous</h3>

      <table *ngIf="appointments.length > 0">
        <thead>
          <tr>
            <th>Date</th>
            <th>Heure</th>
            <th>Motif</th>
            <th>Statut</th>
            <th>Action</th>
          </tr>
        </thead>

        <tbody>
          <tr *ngFor="let appointment of appointments; trackBy: trackById">
            <td>{{ appointment.date | date:'dd/MM/yyyy' }}</td>
            <td>{{ appointment.time }}</td>
            <td>{{ appointment.reason }}</td>
            <td>{{ appointment.statut }}</td>
            <td>
              <button
                (click)="cancelAppointment(+appointment.id)"
                [disabled]="appointment.statut !== 'EN_ATTENTE'">
                Annuler
              </button>
            </td>
          </tr>
        </tbody>
      </table>

      <p *ngIf="appointments.length === 0">Aucun rendez-vous</p>
    </div>
  </div>
</section>
